name: Build

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@master

    - uses: einaregilsson/build-number@v1
      with:
        token: ${{secrets.BARIMALE_TOKEN}}

    - uses: actions/setup-dotnet@v1

    - name: Nuget Restore 
      run: dotnet restore .\\Keycloak.NET.Client.FluentAPI\\Keycloak.NET.Client.FluentAPI\\Keycloak.NET.Client.FluentAPI.csproj

    - name: Build Solution 
      run: dotnet build .\\Keycloak.NET.Client.FluentAPI\\Keycloak.NET.Client.FluentAPI.sln --configuration Release

   # - name: UT Run Tests 
    #  run: dotnet test .\UT.Keycloak.NET.Client.FluentAPI\UT.Keycloak.NET.Client.FluentAPI.csproj --configuration Release

    - name: Nuget Pack
      run: dotnet pack .\\Keycloak.NET.Client.FluentAPI\\Keycloak.NET.Client.FluentAPI\\Keycloak.NET.Client.FluentAPI.csproj  --version-suffix alpha$BUILD_NUMBER  --configuration=Release --output nugetPackages --no-build
      
    - name: Nuget Push
      run: dotnet nuget push **/Keycloak.NET.Client.FluentAPI*.nupkg --source https://nuget.pkg.github.com/barimale/index.json  --api-key 1389c48a05f9ffeb4083262a77749c8d743442b7